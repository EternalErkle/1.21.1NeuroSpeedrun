Config:
  update_notification: true
  data_save_time: 5
  debug_actions: true
  experimental:
    variable_replacement: false
  register_commands:
    - "hello"
  to_condition_groups:
    group1:
      - "%player_has_permission_conditionalevents.somepermission% == yes"
Messages:
  prefix: '&4[&bConditionalEvents&4] '
  commandReload: '&aConfig Reloaded.'
  commandNoPermissions: '&cYou don''t have permissions to use this command.'
  commandResetError: '&cUse &7/ce reset <player> <event>/all'
  eventDoesNotExists: '&cThat event doesn''t exists on the config.'
  eventDataReset: '&aData reset for player &e%player% &aon event &e%event%&a!'
  eventDataResetAll: '&aAll data reset for player &e%player%&a!'
  eventDataResetForAllPlayers: '&aData reset for &eall players &aon event &e%event%&a!'
  eventDataResetAllForAllPlayers: '&aAll player data reset.'
  eventEnableError: '&cUse &7/ce enable <event>'
  eventDisableError: '&cUse &7/ce disable <event>'
  eventEnabled: '&aEvent &7%event% &aenabled.'
  eventDisabled: '&aEvent &7%event% &adisabled.'
  commandDebugError: '&cUse &7/ce debug <event>'
  debugEnabled: '&aDebug now enabled for event &7%event%&a!'
  debugDisabled: '&aDebug disabled for event &7%event%&a!'
  debugEnabledPlayer: '&aDebug now enabled for event &7%event% &aand player &7%player%&a!'
  debugDisabledPlayer: '&aDebug disabled for event &7%event% &aand player &7%player%&a!'
  onlyPlayerCommand: "&cThis command can be only used by a player."
  playerDoesNotExists: '&cThat player doesn''t have any data.'
  seconds: s
  minutes: m
  hours: h
  days: d
  placeholderAPICooldownReady: "Ready!"
  placeholderAPICooldownNameError: "No event with that name!"
  commandCallError: '&cUse &7/ce call <event> (optional)%variable1%=<value1>;%variableN%=<valueN> (optional)player:<player>'
  commandCallInvalidEvent: '&cYou can only execute a CALL event.'
  commandCallCorrect: '&aEvent &7%event% &asuccessfully executed.'
  commandCallCorrectPlayer: '&aEvent &7%event% &asuccessfully executed for player &7%player%&a.'
  commandCallFailed: '&cEvent &7%event% &ccould not be executed. Maybe a format error?'
  playerNotOnline: '&cThat player is not online.'
  commandItemError: "&cUse &7/ce item <save/remove> <name>"
  savedItemDoesNotExists: "&cThat saved item doesn't exists."
  savedItemRemoved: "&aItem &7%name% &aremoved."
  mustHaveItemInHand: "&cYou must have an item on your hand."
  savedItemAlreadyExists: "&cA saved item with that name already exists."
  savedItemAdded: "&aItem &7%name% &asaved."
  commandInterruptError: '&cUse &7/ce interrupt <event> (optional)<player>'
  commandInterruptCorrect: '&aActions of event &7%event% &ainterrupted.'
  commandInterruptCorrectPlayer: '&aActions of event &7%event% &ainterrupted for player &7%player%&a.'
Events: 
  #note to self; run the following commands before pushing to repository. replace %player% with player username
  # papi parse %player% %javascript_data_set,new_world_time,0%
  # papi parse %player% %javascript_data_set,best_time,0%
  # papi parse %player% %javascript_data_set,run_number,1%
  #
  #

  break_blocks:
    type: block_break
    ignore_with_permission: conditionalevents.ignore.event4
    conditions:
      - '%block_world% == Lobby'
    actions:
      default:
        - 'cancel_event: true'

  win_reset:
    type: player_world_change
    conditions:
      - "%world_from% equals world_the_end"
      - '%javascript_data_within_time,win_reset,20% == false' #this is so multiple ppl dont trigger it at once.
      - '%javascript_data_within_time,global_death_protection,20% == false' #this is so multiple ppl dont trigger it at once.
      
    actions:
      default:
        - 'console_command: papi parse %player% "%javascript_data_set_time,world_time%"'  #make it so this event only calls for the FIRST player who enters.
        - 'console_command: papi parse %player% "%javascript_data_set_time,global_death_protection%"' 
        - 'console_command: papi parse %player% "%javascript_data_set_time,win_reset%"' 
        
          #update the best_time
        - 'console_command: papi parse %player% "%javascript_data_compare_best%"'  
        - "to_all: title: 20;100;20; &6&lVICTORY!;&fThe Dragon has been defeated!"
        - "wait: 3"

      #display best time on screen
        - "to_all: title: 20;100;20; &6&lBEST TIME: &f%javascript_data_get_duration,zero_time,best_time%; "
        - "wait: 4"
      #move to lobby
        - "to_all: message: &a&lWORLD RESET! &7Attempt &e#%javascript_data_get,run_number% &7lasted &f%javascript_data_get_duration,new_world_time,world_time%."
        - 'console_command: papi parse %player% "%javascript_data_add,run_number,1%"'
        - "to_all: title: 5;100;5; &b&lMOVING TO ISLAND...;&7Please wait"
        - 'wait: 4'
        - 'to_all: clear_inventory'
        - 'to_all: heal: 20'
        - 'to_all: give_potion_effect: SATURATION;20;1' 
        - "console_command: mv teleport @a Lobby --unsafe"
        - "console_command: advancement revoke @a everything"
    
        # 2. DELETE OLD WORLDS
        - "wait: 1"
        - "console_command: minecraft:kill @e[type=!player,type=!armor_stand,type=!item_frame,type=!painting]"        
        - "console_command: time set 0"
        - "to_all: title: 5;100;5; &b&lGENERATING...;&7Please wait on the island"
        - "wait: 5"
        - "console_command: mv regen world_overworld --seed %random_1_999999%"
        - "console_command: mv regen world_nether --seed %random_1_999999%"
        - "console_command: mv regen world_the_end --seed %random_1_999999%"
                
        - "wait: 1" # Regen is slow; give it time to finish
        # 6. RETURN COUNTDOWN
        - "to_all: title: 0;21;0; &b3;&3&lTELEPORTING...;&bAttempt #%ce_variable_attempts%"
        - "wait: 1"
        - "to_all: title: 0;21;0; &b2;&3&lTELEPORTING...;&bAttempt #%ce_variable_attempts%"
        - "wait: 1"
        - "to_all: title: 0;21;0; &b1;&3&lTELEPORTING...;&bAttempt #%ce_variable_attempts%"
        - "wait: 1"

        
        # 7. FINAL RETURN & SET SURVIVAL
        - "console_command: mv teleport @a world_overworld --unsafe"
        - 'to_all: clear_inventory'
        - 'to_all: heal: 20'
        - "console_command: advancement revoke @a everything"
        - "console_command: gamemode survival @a"
        - 'console_command: papi parse %player% "%javascript_data_set_time,new_world_time%"' 
        - "console_command: effect clear @a"
        - "console_command: effect give @a minecraft:glowing infinite 1 true"
        - 'to_all: give_potion_effect: SATURATION;3;1' 

        - "console_command: experience set @a 0 levels"
        - "console_command: papi parse %player% %javascript_data_clear_enderchests%"

        - "to_all: title: 20;80;20; &a&lGOOD LUCK!;&7Beginning &6&lAttempt &e#%javascript_data_get,run_number%"
        - "to_all: playsound: ENTITY_PLAYER_LEVELUP;10;1"

 # WHEN THE ENDER DRAGON IS BEAT, RESET THE RUN COUNT TO ZERO USING:
  # papi parse %player% %javascript_data_set,run_number,0%
  death_reset:
    type: player_death
    conditions:
      - '%player_world% equals world_overworld or %player_world% equals world_nether or %player_world% equals world_the_end'
    actions:
      default:
        - "console_command: team join Players @a"
        
        - "set_death_message: ''"
        - "to_all: title: 0;60;0; &a☠ &l%player% HAS DIED &a☠;&c&lWORLD RESET"
        - 'console_command: papi parse %player% "%javascript_data_set_time,global_death_protection%"' 
        - 'console_command: papi parse %player% "%javascript_data_set_time,world_time%"' 
        - "wait: 1"
        - "console_command: gamemode survival %player%"
        - "wait: 3"

        - "to_all: message: &c&lWORLD RESET! &7Attempt &e#%javascript_data_get,run_number% &7lasted &f%javascript_data_get_duration,new_world_time,world_time%."
        - "to_all: message: &7Cause of run failure: &c%cause%&7."
        - 'console_command: papi parse %player% "%javascript_data_add,run_number,1%"'
        
        # 3. 10s RESET COUNTDOWN (with player name)
        - "to_all: title: 0;21;0; &e10;&c&l%player% DIED - RESETTING IN..."
        - "wait: 1"
        - "to_all: title: 0;21;0; &e9;&c&l%player% DIED - RESETTING IN..."
        - "wait: 1"
        - "to_all: title: 0;21;0; &e8;&c&l%player% DIED - RESETTING IN..."
        - "wait: 1"
        - "to_all: title: 0;21;0; &e7;&c&l%player% DIED - RESETTING IN..."
        - "wait: 1"
        - "to_all: title: 0;21;0; &e6;&c&l%player% DIED - RESETTING IN..."
        - "wait: 1"
        - "to_all: title: 0;21;0; &e5;&c&l%player% DIED - RESETTING IN..."
        - "wait: 1"
        - "to_all: title: 0;21;0; &e4;&c&l%player% DIED - RESETTING IN..."
        - "wait: 1"
        - "to_all: title: 0;21;0; &e3;&c&l%player% DIED - RESETTING IN..."
        - "to_all: playsound: BLOCK_NOTE_BLOCK_BIT;10;1.2"
        - "wait: 1"
        - "to_all: title: 0;21;0; &e2;&c&l%player% DIED - RESETTING IN..."
        - "to_all: playsound: BLOCK_NOTE_BLOCK_BIT;10;1.4"
        - "wait: 1"
        - "to_all: title: 0;21;0; &e1;&c&l%player% DIED - RESETTING IN..."
        - "to_all: playsound: BLOCK_NOTE_BLOCK_BIT;10;1.6"
        - "wait: 1"

        # 4. MOVE TO Lobby & DELETE WORLDS
        - 'to_all: clear_inventory'
        - 'to_all: heal: 20'
        - 'to_all: give_potion_effect: SATURATION;20;1' 
        - "to_all: console_command: mv teleport @a Lobby --unsafe"
        - "console_command: advancement revoke @a everything"
    
        # 2. DELETE OLD WORLDS
        - "wait: 1"
        - "console_command: minecraft:kill @e[type=!player,type=!armor_stand,type=!item_frame,type=!painting]"        
        - "console_command: time set 0"
        - "to_all: title: 5;100;5; &b&lGENERATING...;&7Please wait on the island"
        - "wait: 5"
        - "console_command: mv regen world_overworld --seed %random_1_999999%"
        - "console_command: mv regen world_nether --seed %random_1_999999%"
        - "console_command: mv regen world_the_end --seed %random_1_999999%"
                
        - "wait: 1" # Regen is slow; give it time to finish
        
        # 6. RETURN COUNTDOWN
        - "to_all: title: 0;21;0; &b3;&3&lTELEPORTING...;&bAttempt #%ce_variable_attempts%"
        - "wait: 1"
        - "to_all: title: 0;21;0; &b2;&3&lTELEPORTING...;&bAttempt #%ce_variable_attempts%"
        - "wait: 1"
        - "to_all: title: 0;21;0; &b1;&3&lTELEPORTING...;&bAttempt #%ce_variable_attempts%"
        - "wait: 1"
        
        # 7. FINAL RETURN & SET SURVIVAL
        - "to_all: console_command: mv teleport @a world_overworld --unsafe"
        - 'to_all: clear_inventory'
        - 'to_all: heal: 20'
        - "console_command: advancement revoke @a everything"
        - "console_command: gamemode survival @a"
        - 'console_command: papi parse %player% "%javascript_data_set_time,new_world_time%"' 
        - "console_command: effect clear @a"
        - "console_command: effect give @a minecraft:glowing infinite 1 true"
        - 'to_all: give_potion_effect: SATURATION;3;1' 

        - "console_command: experience set @a 0 levels"
        - "console_command: papi parse %player% %javascript_data_clear_enderchests%"

        - "to_all: title: 20;80;20; &a&lGOOD LUCK!;&7Beginning &6&lAttempt &e#%javascript_data_get,run_number%"
        - "to_all: playsound: ENTITY_PLAYER_LEVELUP;10;1"

  
  stop_damage_post_death:
    type: player_damage
    conditions:
       - '%javascript_data_within_time,global_death_protection,30% == true'

    actions:
      default:
        - 'cancel_event: true'
        

  stop_damage_lobby:
    type: player_damage
    conditions:
        - '%player_world% equals Lobby'
    actions:
      default:       
       - 'cancel_event: true'
      

  stop_enemy_spawing_lobby:
    type: entity_spawn
    conditions:
      - '%player_world% equals Lobby'
    actions:
      default:
        - 'cancel_event:true'

  move_to_world:
    type: player_join
    conditions: 
      - '%player_world% equals Lobby or %player_world% equals world' 
    actions:
      default:
        - 'if: %javascript_data_within_time,global_death_protection,20% == true execute: console_command: mv tp %player% Lobby --unsafe'
        - 'if: %javascript_data_within_time,global_death_protection,20% == true execute: stop: true'

        - "if: %player_world% equals Lobby execute: console_command: mv tp %player% world_overworld --unsafe"
        - "if: %player_world% equals world execute: console_command: mv tp %player% world_overworld --unsafe"
        
        - "console_command: team join Players @a"
        - "console_command: effect give @a minecraft:glowing infinite 1 true"
        - "title: 20;80;20;&6&lAttempt &e#%javascript_data_get,run_number%;   "


  server_on:
    type: server_start
    actions:
      default:
       - "console_command: gamerule sendCommandFeedback false"
       - "console_command: gamerule showDeathMessages false"
       - "set_death_message: no"
       - "console_command: gamerule doImmediateRespawn true"
       - "console_command: team add Players"
       - "console_command: team modify Players color green"


  start_timer_first_time:
    type: player_join
    conditions: 
       - '%javascript_data_get,new_world_time% == "0" or %javascript_data_get,new_world_time% == 0'
    actions:
      default:
        - 'console_command: papi parse %player% "%javascript_data_set_time,new_world_time%"' 

  create_null_objects:
    type: player_join
    actions:
      default:
        #create null time object
       - 'console_command: papi parse %player% "%javascript_data_set,zero_time,0%"' 
  